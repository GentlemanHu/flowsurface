# MT5 Server 文件说明

## 项目概述

MetaTrader 5 数据桥接服务器，通过 WebSocket 将 MT5 市场数据（交易、深度、K线）推送给 Flowsurface 桌面应用。

## 快速开始

### 安装

1. 将整个 `MT5Server` 目录复制到 MT5 终端的 `MQL5/Experts/` 目录下
2. 在 MetaEditor 中打开 `FlowsurfaceServer.mq5` 并编译
3. 将编译后的 EA 加载到任意图表

### 运行

1. 配置 EA 输入参数（端口、API Key、品种列表）
2. 确保 MT5 终端允许 WebSocket 连接
3. 在 Flowsurface 中配置 MT5 连接

## 项目结构

```
MT5Server/
├── FlowsurfaceServer.mq5   # 主 Expert Advisor
└── Include/
    ├── Authentication.mqh   # API Key + HMAC 认证
    ├── JsonBuilder.mqh      # JSON 序列化工具
    └── WebSocketServer.mqh  # WebSocket 协议实现
```

## 文件说明

### FlowsurfaceServer.mq5
主 EA 文件，负责：
- WebSocket 服务端管理
- 市场数据采集 (OnTick, OnBookEvent)
- 客户端会话管理
- 消息路由和响应

### Include/Authentication.mqh  
安全认证模块：
- API Key 验证
- HMAC-SHA256 签名
- 时间戳防重放
- IP 白名单

### Include/JsonBuilder.mqh
高性能 JSON 工具：
- 零拷贝字符串构建
- 嵌套对象/数组支持
- 基础 JSON 解析

### Include/WebSocketServer.mqh
WebSocket 协议实现：
- HTTP 升级握手
- 帧编解码
- 掩码处理
- 连接管理

## 技术栈

- MQL5
- WebSocket over TCP
- JSON 消息协议
- HMAC-SHA256 认证

## 环境要求

- MetaTrader 5 终端
- 允许 WebSocket/Socket 连接
- 配置的品种在 Market Watch 中可见

## 注意事项

> ⚠️ **AI 生成代码**：此代码由 AI 生成，需要在实际 MT5 环境中测试验证。

> ⚠️ **MQL5 限制**：MQL5 原生不支持服务端 Socket，可能需要配合外部 TCP 代理或使用其他方式建立连接。

> 🔐 **安全**：API Secret 应妥善保管，不要提交到版本控制系统。
